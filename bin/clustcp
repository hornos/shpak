#!/bin/bash

# header ------------------------------------------------------------------------
. $(dirname ${0})/../lib/h.sh

# options -----------------------------------------------------------------------
_c="default"
_s=""
_t=3
while getopts c:s:h o; do
  case "$o" in
    c) _c=$OPTARG;;
    s) _s=$OPTARG;;
    t) _t=$OPTARG;;
    h) echo "Usage: ${sp_g_bn} -c cluster -s source [-t mode]"
       exit 1;;
  esac
done

# main --------------------------------------------------------------------------
for hi in ${sp_p_hosts}/* ; do
  hibn=$(basename ${hi})
  sp_g_cluster=""
  . ${hi}
  if test "${sp_g_cluster}" = "${_c}" ; then
    sshpush -m "${hibn}" -s "${_s}" -t ${_t}
  fi
done
