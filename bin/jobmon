#!/bin/bash

# Arguments
if test $# -lt 1 ; then
  exit 1
fi

_job=${1}
_out="job_${_job}.nodes"

echo "Start to monitor job:"
scontrol show job ${_job}
if test $? -gt 0 ; then
  exit 1
fi

# Nodelist
_nodes=$(scontrol show job ${_job} | egrep "^ *NodeList" | sed s/\ *NodeList=//)
if test -z "${_nodes}" ; then
  exit 1
fi
scontrol show hostnames ${_nodes} > ${_out}

# Stat
pmstat -H ${_out}
